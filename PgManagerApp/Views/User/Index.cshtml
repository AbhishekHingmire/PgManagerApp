@model PgManagerApp.Models.UserRegistration
<style>
    /* Style for the container to make it scrollable */
    .scrollable-container {
        max-height: 800px;
        overflow-y: auto;
        scrollbar-width: thin; /* Firefox */
        scrollbar-color: #007bff #f1f1f1; /* Firefox */
    }

        /* For WebKit browsers (Chrome, Safari) */
        .scrollable-container::-webkit-scrollbar {
            width: 8px;
        }

        .scrollable-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .scrollable-container::-webkit-scrollbar-thumb {
            background-color: #007bff;
            border-radius: 10px;
            border: 2px solid #f1f1f1;
        }

            .scrollable-container::-webkit-scrollbar-thumb:hover {
                background-color: #0056b3;
            }
</style>
<!-- Begin Page Content -->
<div class="container-fluid mb-4">

    <!-- Modal Structure -->
    @{
        if (TempData["UserData"] != null)
        {
            var user = TempData["UserData"] as PgManagerApp.Models.UserRegistration;
            <!-- Edit User -->
            if (Model != null && !Model.ViewOnly)
            {
                <div class="modal fade show" id="autoPopupModal" tabindex="-1" aria-labelledby="autoPopupModalLabel" aria-hidden="true" style="display: block;">
                    <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="autoPopupModalLabel">Edit</h5>
                            <i type="button" class="fas fa-times fa-md text-secondary" data-dismiss="modal"></i>
                        </div>
                        <div class="modal-body">
                            <form asp-action="AddOrEdit" method="post">
                                <input asp-for="Id" class="form-control" type="hidden" required>
                                <div class="mb-3">
                                    <label class="form-label">Name*</label>
                                    <input asp-for="Name" class="form-control" required>
                                    <span asp-validation-for="Name" class="text-danger"></span>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input asp-for="Email" class="form-control" type="email">
                                    <span asp-validation-for="Email" class="text-danger"></span>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Mobile*</label>
                                    <input asp-for="MobileNumber" class="form-control" type="tel" required>
                                    <span asp-validation-for="MobileNumber" class="text-danger"></span>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Address*</label>
                                    <textarea asp-for="Address" class="form-control" rows="3" required></textarea>
                                    <span asp-validation-for="Address" class="text-danger"></span>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Designation*</label>
                                    <input asp-for="Designation" class="form-control" required>
                                    <span asp-validation-for="Designation" class="text-danger"></span>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Identity Type*</label>
                                    <select asp-for="IdentityType" id="identityType" class="form-control" required>
                                        <option value="" selected disabled>Select Identity Type</option>
                                        <option value="Aadhar">Aadhar</option>
                                        <option value="PAN">PAN</option>
                                    </select>
                                    <span asp-validation-for="IdentityType" class="text-danger"></span>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Identity Number*</label>
                                    <input asp-for="IdentityNumber" id="identityNumber" class="form-control" required>
                                    <span class="text-danger custom-validation"></span>
                                </div>
                                <button type="submit" onClick="OnClickSubmit()" class="btn btn-sm btn-primary">Update</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            
        }


        <!-- View User -->
        if (Model.ViewOnly)
        {
            var userDetails = TempData["UserDetails"] as PgManagerApp.Models.UserRegistration;

            <div class="modal fade show" id="autoPopupModal" tabindex="-1" aria-labelledby="autoPopupModalLabel" aria-hidden="true" style="display: block;">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="autoPopupModalLabel">User Details</h5>
                            <i type="button" class="fas fa-times fa-md text-secondary" data-dismiss="modal"></i>
                        </div>
                        <div class="modal-body">
                            <div class="container m-auto mt-4">
                                <!-- User Profile Card -->
                                  
                                        <!-- User Image and Basic Info -->
                                        <div class="d-flex align-items-center mb-3">
                                            <img src="" alt="User Image" class="rounded-circle border mr-2" style="width: 70px; height: 70px;">
                                            <div class="ms-3">
                                            <h6 class="card-subtitle mb-2 text-muted"><strong>@Model.Name</strong></h6>
                                             </div>
                                        </div>
                                        <!-- User Details Table -->
                                        <div class="table-responsive">
                                            <table class="table table-borderless">
                                                <tbody>
                                                    <tr>
                                                        <th scope="row">Name:</th>
                                                        <td>@Model.Name</td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row">Email:</th>
                                                        <td>@Model.Email</td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row">Mobile:</th>
                                                        <td>@Model.MobileNumber</td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row">Address:</th>
                                                        <td>@Model.Address</td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row">Designation:</th>
                                                        <td>@Model.Designation</td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row">Identity Type:</th>
                                                        <td>@Model.IdentityType</td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row">Identity Number:</th>
                                                        <td>@Model.IdentityNumber</td>
                                                    </tr>
                                                <tr>
                                                    <th scope="row">Created Date:</th>
                                                    <td>@Model.CreatedDate?.ToString("yyyy-MM-dd")</td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                   
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        }
    }
    }
    
    


    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800 m-1">User Management</h1>
        <a href="#" class="d-sm-inline-block btn btn-sm m-1 btn-primary shadow-sm" data-toggle="modal"
           data-target="#exampleModal"><i class="fas fa-plus fa-md text-white-50"></i> Add User</a>
    </div>
    <!-- Add User -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModal"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addUserModalLabel">New User</h5>
                        <i type="button" class="fas fa-times fa-md text-secondary" data-dismiss="modal"></i>
                    </div>
                    <div class="modal-body">
                        <!--Add user form-->
                    <form asp-action="AddOrEdit" method="post">
                            <div class="mb-3">
                                <label class="form-label">Name*</label>
                                <input asp-for="Name" class="form-control" required>
                                <span asp-validation-for="Name" class="text-danger"></span>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Email</label>
                                <input asp-for="Email" class="form-control" type="email">
                                <span asp-validation-for="Email" class="text-danger"></span>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Mobile*</label>
                                <input asp-for="MobileNumber" class="form-control" type="tel" required>
                                <span asp-validation-for="MobileNumber" class="text-danger"></span>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Address*</label>
                                <textarea asp-for="Address" class="form-control" rows="3" required></textarea>
                                <span asp-validation-for="Address" class="text-danger"></span>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Designation*</label>
                                <input asp-for="Designation" class="form-control" required>
                                <span asp-validation-for="Designation" class="text-danger"></span>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Identity Type*</label>
                                <select asp-for="IdentityType" id="identityType" class="form-control" required>
                                    <option value="" selected disabled>Select Identity Type</option>
                                    <option value="Aadhar">Aadhar</option>
                                    <option value="PAN">PAN</option>
                                </select>
                                <span asp-validation-for="IdentityType" class="text-danger"></span>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Identity Number*</label>
                                <input asp-for="IdentityNumber" id="identityNumber" class="form-control" required>
                                <span class="text-danger custom-validation"></span>
                            </div>
                            <button type="submit" onClick="OnClickSubmit()" class="btn btn-sm btn-primary">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
                    
                    @{
                        if(TempData["Message"]!=null)
                    {
             <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check fa-md text-success"></i>
            <strong>@TempData["Message"]</strong>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
                    }

                    else if(TempData["Error"]!=null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-times fa-md text-danger"></i>
            <strong>@TempData["Error"]</strong>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    }
    }



    <div class="shadow rounded">
        <div class="scrollable-container" style="overflow-y: auto; overflow-x: auto; position: relative;">
            <table class="table align-middle bg-white rounded">
                <thead class="thead bg-primary text-white" style="position: sticky; top: -1px; z-index: 1;">
                    <tr>
                        <th>User Name</th>
                        <th>Mobile</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        var a = 0;
                        if (Model.Users != null)
                        {
                            foreach (var data in Model.Users)
                            {
                                a++;
                                <tr class="justify-content-around">
                                    <td class="text-left">
                                        <div class="d-flex align-items-center justify-content-left">
                                            <img src="@($"https://mdbootstrap.com/img/new/avatars/{a}.jpg")" alt="dp" style="width: 45px; height: 45px" class="rounded-circle" />
                                            <div class="ml-3">
                                                <p class="fw-bold mb-1">@data.Name</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-left">
                                        <div class="d-flex align-items-center justify-content-left">
                                            <div class="">
                                                <p class="fw-bold mb-1">+91 @data.MobileNumber</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <!-- View Button Form -->
                                        <form asp-action="AddOrEdit" method="post" class="d-inline">
                                            <input type="hidden" name="Id" value="@data.Id" />
                                            <input type="hidden" name="ViewOnly" value="true" />
                                            <button type="submit" class="btn bg-light text-primary btn-sm m-1">
                                                <i class="fas fa-eye"></i>
                                                View
                                            </button>
                                        </form>
                                        <form asp-action="AddOrEdit" method="post" class="d-inline">
                                            <input type="hidden" name="Id" value="@data.Id" />
                                            <button type="submit" class="btn bg-light text-info btn-sm m-1">
                                                <i class="fas fa-edit"></i>
                                                Update
                                            </button>
                                        </form>
                                        <form asp-action="DeleteUser" method="post" class="d-inline">
                                            <input type="hidden" name="Id" value="@data.Id" />
                                            <button type="submit" class="btn bg-light text-danger btn-sm m-1" onclick="return confirm('Are you sure you want to delete this user?');">
                                                <i class="fas fa-trash"></i>
                                                Delete
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="2">
                                    <h3 class="text-center">No data found!</h3>
                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>


</div>
<!-- End Page Content -->
<script>
    function OnClickSubmit() {
        $('.custom-validation').text('').hide();

        const identityType = $('#identityType').val();
        const identityNumber = $('#identityNumber').val().trim();

        if (identityType === 'Aadhar') {
            if (!/^\d{12}$/.test(identityNumber)) {
                $('#identityNumber').next('.custom-validation').text("Not a valid Aadhar number.").show();
            }
        } else if (identityType === 'PAN') {
            if (!/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/.test(identityNumber)) {
                $('#identityNumber').next('.custom-validation').text("Not a valid PAN number.").show();
            }
        }
    }


    document.addEventListener('DOMContentLoaded', function () {
        var myModal = new bootstrap.Modal(document.getElementById('autoPopupModal'), {
            keyboard: false
        });
        myModal.show();
    });
</script>